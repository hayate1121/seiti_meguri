<div class="container">
  <div class="row">
    <div class="col">
      <h4>作品詳細</h4>
    </div>
  </div>
  <div class="row mt-3">
    <div class="col">
      <%= image_tag @anime.get_anime_image(400,500) %>
    </div>
    <div class="col">
      <div id="map"></div>
      <style>
      #map {
        height: 300px;
        width: 500px;
      }
      </style>
      <script>
        let map
        function initMap(){
          geocoder = new google.maps.Geocoder()
          
          map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: <%= @latitude %>, lng: <%= @longitude %>},
            zoom: 12,
          });
          
          let i = 0
          
          const marker = []
          
          const infoWindow = []
          
          const markerEvent = (i) => {
            marker[i].addListener('click', () => {
              for (const j in marker) {
                infoWindow[j].close(map, marker[j]);
              }
              infoWindow[i].open(map, marker[i]);
            });
          }
          
          <% @scenes.each do |scene| %>
            marker[i] = new google.maps.Marker({
              position:  {lat: <%= scene.latitude %>, lng:<%= scene.longitude %>},
              map: map
            });
            
            infoWindow[i] = new google.maps.InfoWindow({
              content: `<%= link_to scene.scene_name, admin_scene_path(scene.id), data: {"turbolinks" => false} %>`
            });
            
            markerEvent(i);
            
            i++;
          <% end %>
          
          <% @stores.each do |store| %>
            marker[i] = new google.maps.Marker({
              position:  {lat: <%= store.latitude %>, lng:<%= store.longitude %>},
              map: map
            });
            
            infoWindow[i] = new google.maps.InfoWindow({
              content: `<%= link_to store.store_name, admin_store_path(store.id), data: {"turbolinks" => false} %>`
            });
            
            markerEvent(i);
            
            i++;
          <% end %>
          
        }
      </script>
      <script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAP_API_KEY'] %>&callback=initMap" async defer></script>
    </div>
  </div>
  <div class="row mt-4">
    <div class="col">
      作品名
    </div>
    <div class="col">
      <%= @anime.title %>
    </div>
  </div>
  <div class="row">
    <div class="col">
      ジャンル
    </div>
    <div class="col">
      <% @anime.tags.each do |tag| %>
        <%= tag.tag_name %>
      <% end %>
    </div>
  </div>
  <div class="row">
    <div class="col">
      舞台
    </div>
    <div class="col">
      <%= @anime.spot %>
    </div>
  </div>
  <div class="row">
    <div class="col">
      シーン一覧
    </div>
    <div class="col">
      <% @scenes.each do |scene| %>
        <%= link_to scene.scene_name, admin_scene_path(scene.id), data: {"turbolinks" => false} %><br>
      <% end %>
    </div>
  </div>
  <div class="row">
    <div class="col">
      <%= link_to "編集する", edit_admin_anime_path %>
    </div>
    <div class="col">
      <%= link_to "シーン追加", new_admin_scene_path(anime_id: @anime.id) %>
    </div>
  </div>
</div>